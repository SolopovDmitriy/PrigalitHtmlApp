<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Пацієнти</title>
  <link rel="stylesheet" href="assets/styles.css">
</head>
<body>
  <div class="frame">
    <div class="content">
      <h1>Пацієнти</h1>

      <div class="toolbar">
        <a class="btn btn-primary" href="create-patient.html">+ Додати пацієнта</a>
      </div>

      <div id="list"></div>
      <div class="helper" id="empty" style="display:none;">Поки що немає пацієнтів.</div>
    </div>
  </div>

  <script type="module">
    import { loadPatients } from './assets/storage.js';

    const list = document.getElementById('list');
    const empty = document.getElementById('empty');

    function render(){
      const patients = loadPatients();
      if (!patients.length){
        empty.style.display = 'block';
        list.innerHTML = '';
        return;
      }
      empty.style.display = 'none';

      list.innerHTML = patients
        .slice()
        .sort((a,b)=> (a.full_name||'').localeCompare(b.full_name||''))
        .map(p=>`
          <div class="card" style="margin-bottom:12px;">
            <div class="kv">
              <div class="k">ПІБ</div><div class="v">${escapeHtml(p.full_name || '—')}</div>
              <div class="k">Дата народження</div><div class="v">${escapeHtml(p.date_of_birth || '—')}</div>
              <div class="k">Профіль</div><div class="v">${escapeHtml(p.profile || '—')}</div>
              <div class="k">Контакти</div><div class="v">${escapeHtml((p.email||'') + (p.phone ? ' · ' + p.phone : ''))}</div>
            </div>
            <div class="toolbar" style="justify-content:flex-end; margin-top:12px;">
              <a class="btn btn-primary" href="patient-profile.html?patient=${encodeURIComponent(p.id)}">Відкрити профіль →</a>
            </div>
          </div>
        `).join('');
    }

    function escapeHtml(str){
      return String(str).replace(/[&<>"']/g, (m)=>({
        '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
      }[m]));
    }

    render();
  </script>
</body>
</html>
